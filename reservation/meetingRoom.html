<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.15/index.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.15/index.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="../style.main.css">
    <link rel="stylesheet" href="../wit.css">
</head>

<body>
    <!-- 공통영역 -->
    <div class="container">
        <div class="sideBar">
            <div class="top">
                <i class="bx bx-menu" id="btn"></i>
            </div>
            <div class="user">
                <img src="메인게임.webp" alt="me" class="userImg">
                <div class="nickName">
                    <p class="bold">Wit Works</p>
                    <p></p>
                </div>
            </div>

            <ul>
                <li>
                    <a href="#">
                        <i class='bx bxs-home-alt-2'></i>
                        <span class="navItem">홈</span>
                    </a>
                    <span class="toolTip">홈</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-paperclip'></i>
                        <span class="navItem">주소록</span>
                    </a>
                    <span class="toolTip">주소록</span>
                </li>
                <li>
                    <a href="board2.html">
                        <i class="bx bxs-grid-alt"></i>
                        <span class="navItem">게시판</span>
                    </a>
                    <span class="toolTip">게시판</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-calendar-alt'></i>
                        <span class="navItem">캘린더</span>
                    </a>
                    <span class="toolTip">캘린더</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bxs-message-dots'></i>
                        <span class="navItem">메신저</span>
                    </a>
                    <span class="toolTip">메신저</span>
                </li>
                <li>
                    <a href="../eApproval/home.html">
                        <i class='bx bx-clipboard'></i>
                        <span class="navItem">전자결재</span>
                    </a>
                    <span class="toolTip">전자결재</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bxs-briefcase-alt-2'></i>
                        <span class="navItem">근태관리</span>
                    </a>
                    <span class="toolTip">근태관리</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bxs-check-square'></i>
                        <span class="navItem">예약</span>
                    </a>
                    <span class="toolTip">예약</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-sitemap'></i>
                        <span class="navItem">조직도</span>
                    </a>
                    <span class="toolTip">조직도</span>
                </li>

            </ul>
        </div>
        <!-- 공통역역 끝 -->

        <div class="main-content">
            <div class="header">
                <span class="alert"><a href=""><i class='bx bxs-bell'></i></a></span>
                <!--마이페이지로 이동-->
                <span class="myName">
                    <img src="메인게임.webp"><a href=" #">백민주 사원</a></span>
                <span class="logOut"><a href="#">LogOut</a></span>
            </div>
            <div class="contents">
                <div class="sideAbout">
                    <div class="sideTxt">
                        <a href="#">
                            <h2 class="sideTit">예약관리</h2>
                        </a>
                    </div>
                    <div class="addressListPrivate">
                        <ul class="privateList">
                            <li class="toggleItem">
                                <h3 class="toggleTit">회의실</h3>
                                <ul class="subList">
                                    <li><a href="meetingRoom.html">회의실 1</a></li>
                                    <li><a href="meetingRoom.html">회의실 2</a></li>
                                    <li><a href="meetingRoom.html">회의실 3</a></li>
                                    <li><a href="meetingRoom.html">회의실 4</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="addressListGroup">
                        <ul class="GroupList">
                            <li class="toggleItem">
                                <h3 class="toggleTit">차량</h3>
                                <ul class="subList">
                                    <li><a href="vehicle.html">BMW X6_9688</a></li>
                                    <li><a href="vehicle.html">싼타페_7574</a></li>
                                    <li><a href="vehicle.html">마이바흐_1106</a></li>
                                    <li><a href="vehicle.html">G90_9720</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="sideContents reservation meetingRooms">
                    <div class="mainTitle">회의실 [ 회의실1 ]</div>
                    <div class="reservBox">
                        <div class="calendar" id="calendar"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 날짜 박스 눌렀을 시 모달 -->
        <div id="reservModal" class="modal">
            <div class="modalContent">
                <h1>회의실 예약<span class="modalClose">&times</span></h1>
                <div class="calendarAdd">
                    <ul>
                        <li>
                            <span>회의실 명</span>
                            <div><input type="text" value="회의실 1" readonly></div>
                        </li>
                        <li>
                            <span>예약 기간</span>
                            <div><input type="date" class="startDate dateInput">&nbsp;&nbsp;<input type="time"
                                    class="startDate dateInput">&nbsp;&nbsp;~&nbsp;&nbsp;<input type="date"
                                    class="endDate dateInput">&nbsp;&nbsp;<input type="time" class="endDate dateInput">
                            </div>
                        </li>
                        <li>
                            <span>장소</span>
                            <div><input type="text" class="eventLocation" value="신설동 12 5층 505호" readonly></div>
                        </li>
                        <li>
                            <span>예약 목적</span>
                            <div><textarea id="calendarText"></textarea></div>
                        </li>
                        <li>
                            <div class="btns">
                                <button id="addBtn" class="okBtn">완료</button><button class="cancelBtn">취소</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- 일정을 클릭 시 모달 -->
        <div id="eventModal" class="modal">
            <div class="modalContent">
                <h1>회의실 예약 내용<span class="modalClose">&times</span></h1>
                <div class="calendarAdd">
                    <ul>
                        <li>
                            <span>회의실 명</span>
                            <div><input type="text" value="회의실 1" readonly></div>
                        </li>
                        <li>
                            <span>예약자</span>
                            <div>
                                <input type="text" value="인사부" readonly>&nbsp;&nbsp;<input type="text" value="이웡히"
                                    readonly>
                            </div>
                        </li>
                        <li>
                            <span>예약 기간</span>
                            <div><input type="date" id="startDate" class="startDate dateInput"
                                    readonly>&nbsp;&nbsp;<input type="time" id="startTime" class="startDate dateInput"
                                    readonly>&nbsp;&nbsp;~&nbsp;&nbsp;<input type="date" id="endDate"
                                    class="endDate dateInput" readonly>&nbsp;&nbsp;<input type="time" id="endTime"
                                    class="endDate dateInput" readonly>
                            </div>
                        </li>
                        <li>
                            <span>장소</span>
                            <div><input type="text" class="eventLocation" value="신설동 12 5층 505호" readonly></div>
                        </li>
                        <li>
                            <span>예약 목적</span>
                            <div><textarea id="calendarText" readonly>그냥 ~~~~</textarea></div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</body>
<!-- sidebar 공통요소 script -->
<script>
    let btn = document.querySelector("#btn")
    let sideBar = document.querySelector(".sideBar")

    btn.onclick = function () {
        sideBar.classList.toggle("active")
    };

    const toggleItems = document.querySelectorAll('.toggleItem');

    toggleItems.forEach(function (toggleItem) {
        const toggleTit = toggleItem.querySelector('.toggleTit');
        const subList = toggleItem.querySelector('.subList');

        toggleTit.addEventListener('click', function () {
            subList.classList.toggle('active');
            toggleTit.classList.toggle('active'); // 이미지 회전을 위해 클래스 추가
        });
    });

    $('.cancelBtn').on('click', function () {
        location.reload();
    })

    $('#addBtn').on('click', function () {
        // 입력 필드값 변수에 저장
        let eventName = $('#eventName').val();
        let startDate = $('#startDate').val();
        let startTime = $('#startTime').val();
        let endDate = $('#endDate').val();
        let endTime = $('#endTime').val();
        let calendar = $('#choiCalendar').val();
        let eventLocation = $('#eventLocation').val();
        let calendarText = $('#calendarText').val();

        // 입력 필드에서 가져온 값을 사용하여 이벤트 객체 생성
        let event = {
            eventName: eventName,
            startDate: startDate,
            startTime: startTime,
            endDate: endDate,
            endTime: endTime,
            calendar: calendar,
            eventLocation: eventLocation,
            calendarText: calendarText
        };

        $('#calendarModal').hide();
    })




    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            dayCellContent: function (e) {
                return e.dayNumberText.replace('일', '');
            },
            locale: "ko",
            initialDate: new Date(),
            timeZone: 'Asia/Seoul',
            editable: false,
            selectable: true,
            businessHours: true,
            dayMaxEvents: true,
            buttonText: {
                today: '오늘'
            },
            dateClick: function (info) {
                //날짜 클릭 시 발생할 이벤트
                $('.startDate').val(info.dateStr);
                $("#reservModal").show();
                $(".modalClose").on("click", function () {
                    $("#reservModal").hide();
                });
            },
            eventClick: function (info) {
                // 이벤트 클릭 시 발생할 이벤트
                let eventTitle = info.event._def.title;
                // 이벤트 시작 날짜를 ISO 형식으로 변환
                // 이벤트의 시작과 종료 시간을 한국 시간으로 변환
                let eventStartUTC = new Date(info.event.start);
                let eventEndUTC = info.event.end ? new Date(info.event.end) : new Date(eventStartUTC.getTime() + 24 * 60 * 60 * 1000);

                // 한국 표준시(KST)로 변환
                let eventStartKST = new Date(eventStartUTC.toLocaleString('en-US', { timeZone: 'Asia/Seoul' }));
                let eventEndKST = new Date(eventEndUTC.toLocaleString('en-US', { timeZone: 'Asia/Seoul' }));

                // 날짜와 시간 분리
                let eventStartDate = eventStartKST.toISOString().split('T')[0];
                let eventStartTime = eventStartKST.toISOString().split('T')[1].substring(0, 5);
                let eventEndDate = eventEndKST.toISOString().split('T')[0];
                let eventEndTime = eventEndKST.toISOString().split('T')[1].substring(0, 5);
                let eventContent = info.event.extendedProps.content;

                console.log(eventStartDate + ' : ' + eventStartTime);
                // console.log(new Date(info.event.start.getTime() - 9 - (info.event.start.getTimezoneOffset() * 60000)).toISOString().split('T')[1].substring(0, 5));

                $('.eventName').val(eventTitle);
                $('#startDate').val(eventStartDate);
                $('#startTime').val(eventStartTime);
                $('#endDate').val(eventEndDate);
                $('#endTime').val(eventEndTime);
                $('#eventText').val(eventContent);
                $("#eventModal").show();
                $(".modalClose").on("click", function () {
                    $("#eventModal").hide();
                });
            },
            events: [
                // 시간을 입력하지 않으면 오늘 정각부터 다음 날 정각까지
                {
                    title: 'All Day Event',
                    start: '2024-07-30'
                }
            ]
        });

        calendar.render();
    });

</script>

</html>